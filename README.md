# BOX MAGIC OCR INTELLIGENT 2026

## ğŸ¯ OBJECTIF

Brique OCR modulaire intelligente Ã  3 niveaux pour le traitement automatisÃ© de documents comptables et commerciaux.

**RÃˆGLE ABSOLUE** : Ce module est une BRIQUE INTÃ‰GRABLE, pas une refonte globale.

## ğŸ—ï¸ ARCHITECTURE GLOBALE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PIPELINE EXISTANT                         â”‚
â”‚              (Google Drive + Google Sheets)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Document PDF/Image
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   OCR ENGINE (Point d'entrÃ©e)                â”‚
â”‚                  - DÃ©tection entreprise                       â”‚
â”‚                  - Routage intelligent                        â”‚
â”‚                  - Gestion logs                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚
         â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  OCR 1  â”‚â”€â”€Ã‰checâ”€â”€â†’ â”‚  OCR 2   â”‚
    â”‚ RAPIDE  â”‚           â”‚ APPROFONDIâ”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚ 80% OK              â”‚ Ã‰chec rare
         â”‚                     â–¼
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚    OCR 3     â”‚
         â”‚              â”‚ CONTRÃ”LE +   â”‚
         â”‚              â”‚ MÃ‰MOIRE      â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚                     â”‚ CrÃ©e rÃ¨gle
         â”‚                     â–¼
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ MEMORY STORE â”‚
                          â”‚ (RÃ¨gles AI)  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ã‰CRITURE GOOGLE SHEETS                          â”‚
â”‚  - INDEX GLOBAL                                              â”‚
â”‚  - CRM                                                       â”‚
â”‚  - COMPTABILITÃ‰                                              â”‚
â”‚  - LOG SYSTEM                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ NIVEAUX OCR DÃ‰TAILLÃ‰S

### ğŸ”¹ OCR NIVEAU 1 â€” RAPIDE & STABLE
**Objectif** : Traiter 80% des documents standards

**Fonctions** :
- âœ… DÃ©tection type document (facture, devis, ticket, reÃ§u, BL)
- âœ… Extraction dates (Ã©mission, Ã©chÃ©ance, paiement)
- âœ… Montants (HT / TVA / TTC)
- âœ… TVA si unique et Ã©vidente
- âœ… Ã‰metteur / Destinataire (logique classique)
- âœ… Score de confiance par champ
- âœ… SÃ©paration ENTREPRISE SOURCE / CLIENT / FOURNISSEUR

**Sortie** :
```json
{
  "level": 1,
  "confidence": 0.85,
  "type": "facture",
  "entreprise_source": "Martin's Traiteur",
  "client": {
    "name": "Restaurant Le Gourmet",
    "confidence": 0.9
  },
  "fields": {
    "date": {"value": "2026-01-10", "confidence": 0.95},
    "total_ttc": {"value": 1200.00, "confidence": 0.90}
  },
  "needs_level2": false
}
```

### ğŸ”¹ OCR NIVEAU 2 â€” ANALYSE APPROFONDIE
**DÃ©clenchement** :
- Confiance OCR1 < seuil (par dÃ©faut 0.7)
- Champs manquants critiques
- AmbiguÃ¯tÃ©s dÃ©tectÃ©es

**Fonctions** :
- âœ… Analyse contextuelle avancÃ©e
- âœ… Recherche croisÃ©e d'informations
- âœ… AmÃ©lioration champ par champ
- âœ… PrÃ©servation des champs fiables d'OCR1
- âœ… Calculs et vÃ©rifications de cohÃ©rence

**Sortie** :
```json
{
  "level": 2,
  "confidence": 0.78,
  "improved_fields": ["tva", "client_siret"],
  "needs_level3": false
}
```

### ğŸ”¹ OCR NIVEAU 3 â€” CONTRÃ”LE & MÃ‰MOIRE (RARE)
**DÃ©clenchement** :
- OCR2 insuffisant
- Cas nouveau/inconnu
- Demande explicite de validation

**Fonctions** :
- âœ… VÃ©rification cohÃ©rence globale
- âœ… Correction champs FAUX
- âœ… ComplÃ©tion champs ABSENTS
- âœ… CrÃ©ation RÃˆGLE MÃ‰MOIRE rÃ©utilisable
- âœ… Stockage dans AI Memory

**Sortie** :
```json
{
  "level": 3,
  "confidence": 0.92,
  "corrections": ["client_name", "tva_rate"],
  "rule_created": {
    "id": "rule_20260112_001",
    "pattern": "Facture METRO format spÃ©cifique",
    "conditions": ["footer_contains:METRO", "siret:123456789"],
    "actions": ["apply_tva_10", "extract_client_from_line_3"]
  }
}
```

## ğŸ—‚ï¸ STRUCTURE DU PROJET

```
box-magic-ocr-intelligent/
â”œâ”€â”€ README.md                      # Documentation principale
â”œâ”€â”€ ARCHITECTURE.md                # Architecture dÃ©taillÃ©e
â”œâ”€â”€ INTEGRATION.md                 # Guide d'intÃ©gration
â”œâ”€â”€ requirements.txt               # DÃ©pendances Python
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.yaml               # Configuration globale
â”‚   â””â”€â”€ entreprises.yaml          # Configuration multi-entreprises
â”œâ”€â”€ ocr_engine.py                 # ğŸ¯ POINT D'ENTRÃ‰E PRINCIPAL
â”œâ”€â”€ levels/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ocr_level1.py            # OCR Niveau 1 - Rapide
â”‚   â”œâ”€â”€ ocr_level2.py            # OCR Niveau 2 - Approfondi
â”‚   â””â”€â”€ ocr_level3.py            # OCR Niveau 3 - MÃ©moire
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ rule_engine.py           # Gestion des rÃ¨gles
â”‚   â””â”€â”€ ai_memory.py             # Stockage intelligent
â”œâ”€â”€ connectors/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ google_sheets.py         # Connecteur Google Sheets
â”‚   â””â”€â”€ document_loader.py       # Chargement documents
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py                # SystÃ¨me de logs
â”‚   â”œâ”€â”€ validators.py            # Validations
â”‚   â””â”€â”€ document_types.py        # Types de documents
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_integration.py      # Tests d'intÃ©gration
â””â”€â”€ examples/
    â”œâ”€â”€ example_pipeline.py       # Exemple d'utilisation
    â””â”€â”€ sample_config.yaml        # Configuration exemple
```

## ğŸš€ UTILISATION RAPIDE

### Installation

```bash
pip install -r requirements.txt
```

### Configuration

1. Copier `config/config.yaml.example` vers `config/config.yaml`
2. Configurer vos entreprises dans `config/entreprises.yaml`
3. Configurer les credentials Google Sheets

### IntÃ©gration dans le pipeline existant

```python
from ocr_engine import OCREngine

# Initialisation
ocr = OCREngine(config_path="config/config.yaml")

# Traitement d'un document
result = ocr.process_document(
    file_path="document.pdf",
    source_entreprise="Martin's Traiteur"
)

# RÃ©sultat automatiquement Ã©crit dans Google Sheets
# - INDEX GLOBAL
# - CRM (si nouveau client dÃ©tectÃ©)
# - COMPTABILITÃ‰
# - LOG SYSTEM
```

## ğŸ“Š GOOGLE SHEETS EXISTANT (UTILISÃ‰, PAS MODIFIÃ‰)

### CONFIG
ParamÃ¨tres globaux + entreprises

### INDEX GLOBAL
Chaque document traitÃ© = 1 ligne
- ID document
- Type
- Date traitement
- Entreprise source
- Client/Fournisseur
- Montants
- Statut OCR (niveau utilisÃ©)
- Confiance

### CRM
Clients dÃ©tectÃ©s / enrichis
- Nom
- SIRET
- Adresse
- Contact
- Source (dÃ©tection OCR)

### COMPTABILITÃ‰
Factures, tickets, paiements
- RÃ©fÃ©rence
- Type Ã©criture
- Montants HT/TVA/TTC
- Comptes comptables

### LOG SYSTEM
Logs techniques uniquement
- Timestamp
- Niveau OCR
- DÃ©cisions prises
- Erreurs

## ğŸ¢ MULTI-ENTREPRISE

Le systÃ¨me gÃ¨re plusieurs sociÃ©tÃ©s :
- Martin's Traiteur (Cyril Martins)
- MT Production
- Autres futures

**RÃˆGLE CRITIQUE** : Les infos de l'entreprise SOURCE ne polluent JAMAIS les champs CLIENT/FOURNISSEUR.

Configuration entreprise :
```yaml
entreprises:
  - name: "Martin's Traiteur"
    siret: "12345678900012"
    address: "123 rue Example, 75001 Paris"
    phone: "01 23 45 67 89"
    iban: "FR76..."
    tva: "FR12345678900"
    identity:
      logo_patterns: ["martin", "traiteur"]
      footer_patterns: ["Cyril Martins"]
```

## ğŸ” RÃˆGLES DE CONCEPTION

### âœ… OBLIGATOIRE
- Logs dÃ©taillÃ©s et lisibles
- DÃ©cisions explicables
- OCR progressif (1 â†’ 2 â†’ 3)
- Apprentissage rare et utile
- IntÃ©gration sans casser l'existant
- Score de confiance par champ

### âŒ INTERDIT
- Normalisation agressive prÃ©maturÃ©e
- Renommage automatique des fichiers
- Anti-doublon bloquant
- Boucles infinies
- RÃ©-apprentissage permanent inutile
- Pollution des donnÃ©es entreprise/client

## ğŸ“ TYPES DE DOCUMENTS GÃ‰RÃ‰S

- âœ… Factures (clients/fournisseurs)
- âœ… Devis
- âœ… Tickets de caisse
- âœ… ReÃ§us CB
- âœ… Notes de frais
- âœ… Bons de livraison
- âœ… Documents scannÃ©s/photos

MÃªme logique, mÃªme pipeline.

## ğŸ¯ OBJECTIF FINAL

Un OCR :
- âœ… **Stable** - Pas de crash, pas de boucle
- âœ… **Intelligent** - Apprend des cas complexes
- âœ… **Auto-amÃ©liorant** - CrÃ©e des rÃ¨gles rÃ©utilisables
- âœ… **Multi-entreprise** - GÃ¨re plusieurs sociÃ©tÃ©s proprement
- âœ… **Sans boucle** - OCR3 Ã©limine les cas rÃ©pÃ©titifs
- âœ… **Sans nuits blanches** - Logs clairs, debuggable

## ğŸ“š DOCUMENTATION COMPLÃˆTE

- [ARCHITECTURE.md](ARCHITECTURE.md) - Architecture technique dÃ©taillÃ©e
- [INTEGRATION.md](INTEGRATION.md) - Guide d'intÃ©gration pas Ã  pas
- [MEMORY_SYSTEM.md](memory/README.md) - SystÃ¨me de mÃ©moire et rÃ¨gles
- [API.md](API.md) - Documentation API complÃ¨te

## ğŸ¤ SUPPORT

Ce module est conÃ§u pour Ãªtre **stable et autonome**.

En cas de besoin :
1. Consulter les logs dans Google Sheets LOG SYSTEM
2. VÃ©rifier la configuration dans CONFIG
3. Analyser les rÃ¨gles crÃ©Ã©es dans MEMORY STORE

---

**BOX MAGIC 2026** â€” IA PROCESS FACTORY
Version : 1.0.0
Date : Janvier 2026
