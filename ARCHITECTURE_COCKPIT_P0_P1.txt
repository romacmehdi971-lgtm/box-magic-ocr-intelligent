```
================================================================================
ğŸ—ï¸ ARCHITECTURE â€” Cockpit MCP HTTP Client (P0 + P1)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ğŸ‘¤ Ã‰LIA (Google Sheets HUB)                                                â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“Š Google Sheet IAPF Memory HUB                                      â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  SETTINGS (onglet)                                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ key             â”‚ value                                â”‚ â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ mcp_proxy_url   â”‚ https://mcp-memory-proxy-...         â”‚ â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ mcp_api_key     â”‚ kTxWKxMrrrEXtM132Vd1Qqc4Zf6...       â”‚ â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“‹ Menu: IAPF Memory > MCP Cockpit                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ”Œ Test Connection                                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ” GET /infra/whoami                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“Š Test Pagination                                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ› ï¸ HTTP GET Tool                                           â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ§© Apps Script Project (bound to Sheet)                             â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  G09_MCP_HTTP_CLIENT.gs (NEW âœ¨)                            â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  var MCP_HTTP = (function() {                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    function getInfraWhoami() { ... }                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    function getSheet(name, {limit}) { ... }                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    function getGptMemoryLog({limit}) { ... }               â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    // âœ… Strict pass-through query params                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    // âœ… X-API-Key from SETTINGS (secure)                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    // âœ… Returns {ok, status, body, correlation_id, error} â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  })();                                                      â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  G01_UI_MENU.gs (UPDATED âœï¸)                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  function MCP_COCKPIT_testConnection() { ... }             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  function MCP_COCKPIT_getWhoami() { ... }                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  function MCP_COCKPIT_testPagination() { ... }             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  function MCP_COCKPIT_httpGetTool() { ... }                â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ UrlFetchApp.fetch()
                               â”‚ GET requests only (P1)
                               â”‚ X-API-Key header
                               â”‚ Query params: ?limit=N
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  â˜ï¸ GCP â€” Cloud Run Service (us-central1)                                   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸš€ mcp-memory-proxy (v3.1.5-infra-config-fix)                        â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  Revision: mcp-memory-proxy-00025-zmb (100% traffic)                 â”‚ â”‚
â”‚  â”‚  URL: https://mcp-memory-proxy-522732657254.us-central1.run.app      â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“¡ Endpoints (GET only, audit-safe)                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  GET /health                                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  GET /infra/whoami                                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  GET /docs-json                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  GET /sheets/{name}?limit=N&offset=M&cursor=...            â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  GET /gpt/memory-log?limit=N                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  âœ… All query params passed through (P0)                    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  âœ… Errors return {status, body, correlation_id}            â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ” Middleware: READ_ONLY_MODE                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  if method in [POST, PUT, PATCH, DELETE]:                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    return 403 {                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      "detail": "Write operations disabled",                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      "audit_safe": true                                     â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    }                                                         â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“‹ Environment Variables (audit-safe)                      â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                             â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  READ_ONLY_MODE=true        âœ…                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  ENABLE_ACTIONS=false       âœ…                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  DRY_RUN_MODE=true          âœ…                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  LOG_LEVEL=INFO             âœ…                              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  VERSION=v3.1.5-infra-config-fix                           â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  GIT_COMMIT=60d53b8                                         â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“ Backend Code (Python FastAPI)                                     â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  memory-proxy/app/main.py:                                           â”‚ â”‚
â”‚  â”‚    â€¢ Middleware reads os.environ.get("READ_ONLY_MODE") âœ…            â”‚ â”‚
â”‚  â”‚    â€¢ /infra/whoami routed to infra.py âœ…                              â”‚ â”‚
â”‚  â”‚    â€¢ /docs-json includes /infra/whoami âœ…                             â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  memory-proxy/app/infra.py:                                          â”‚ â”‚
â”‚  â”‚    â€¢ WhoAmIResponse includes config: AuditSafeConfig âœ…              â”‚ â”‚
â”‚  â”‚    â€¢ Returns read_only_mode, enable_actions, dry_run_mode âœ…         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ read/write
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Google Sheets API (IAPF Memory HUB data)                                â”‚
â”‚     MEMORY_LOG, SETTINGS, DRIVE_INVENTORY, etc.                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
ğŸ”„ REQUEST FLOW (Example: Test Pagination)
================================================================================

1. Ã‰lia clicks: "IAPF Memory > MCP Cockpit > ğŸ“Š Test Pagination"

2. Apps Script executes: MCP_COCKPIT_testPagination()
   â”œâ”€ Calls: MCP_HTTP.getSheet("SETTINGS", {limit: 1})
   â”œâ”€ Calls: MCP_HTTP.getSheet("MEMORY_LOG", {limit: 5})
   â””â”€ Calls: MCP_HTTP.getSheet("DRIVE_INVENTORY", {limit: 10})

3. MCP_HTTP module (G09_MCP_HTTP_CLIENT.gs):
   â”œâ”€ Reads SETTINGS: mcp_proxy_url, mcp_api_key
   â”œâ”€ Builds URL: https://.../sheets/SETTINGS?limit=1
   â”œâ”€ Sends: UrlFetchApp.fetch(url, {headers: {"X-API-Key": ...}})
   â””â”€ Returns: {ok: true, status: 200, body: {...}, correlation_id: "..."}

4. Cloud Run backend (mcp-memory-proxy):
   â”œâ”€ Receives: GET /sheets/SETTINGS?limit=1
   â”œâ”€ Validates: X-API-Key header âœ…
   â”œâ”€ Middleware: Allows GET (READ_ONLY_MODE) âœ…
   â”œâ”€ Queries: Google Sheets API (SETTINGS sheet, limit=1)
   â””â”€ Returns: {sheet_name: "SETTINGS", row_count: 1, data: [...]}

5. Apps Script displays result:
   "âœ… SETTINGS?limit=1 â†’ 1 rows"

================================================================================
ğŸ” SECURITY LAYERS
================================================================================

Layer 1: Apps Script
  âœ… X-API-Key stored in SETTINGS (never logged)
  âœ… GET only (no POST functions implemented)

Layer 2: Cloud Run Middleware
  âœ… READ_ONLY_MODE=true â†’ blocks POST/PUT/PATCH/DELETE
  âœ… X-API-Key validation (Secret Manager)

Layer 3: Backend Functions
  âœ… ENABLE_ACTIONS=false â†’ no destructive operations
  âœ… DRY_RUN_MODE=true â†’ simulates writes (no real changes)

Layer 4: Traceability
  âœ… correlation_id for each request
  âœ… Logs queryable via /infra/logs/query

================================================================================
âœ… P0 + P1 DELIVERED
================================================================================
```
