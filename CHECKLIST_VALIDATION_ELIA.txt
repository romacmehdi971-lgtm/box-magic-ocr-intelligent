================================================================================
ðŸ“‹ CHECKLIST VALIDATION Ã‰LIA â€” P0 + P1
================================================================================

Date: 2026-02-20
Version: v3.1.5-infra-config-fix + Cockpit HTTP Client
Commit: 33c2cf4

================================================================================
âš™ï¸ PHASE 1: Configuration SETTINGS (prerequisite)
================================================================================

Dans Google Sheet IAPF Memory HUB, onglet SETTINGS:

[ ] Ajouter la ligne:
    key: mcp_proxy_url
    value: https://mcp-memory-proxy-522732657254.us-central1.run.app
    notes: Backend Cloud Run URL

[ ] Ajouter la ligne:
    key: mcp_api_key
    value: kTxWKxMrrrEXtM132Vd1Qqc4Zf6QsmQKLOo_W1PuDWE
    notes: API key (SENSITIVE - do not log)

================================================================================
ðŸ“¦ PHASE 2: DÃ©ploiement Code Apps Script
================================================================================

Dans le projet Apps Script (liÃ© Ã  la Google Sheet):

[ ] CrÃ©er un nouveau fichier: "G09_MCP_HTTP_CLIENT"
[ ] Copier le contenu de: HUB_COMPLET/G09_MCP_HTTP_CLIENT.gs
[ ] Remplacer le fichier "G01_UI_MENU" avec: HUB_COMPLET/G01_UI_MENU.gs
[ ] Sauvegarder le projet (Ctrl+S / âŒ˜+S)
[ ] Fermer et rouvrir la Google Sheet (ou Ctrl+R / âŒ˜+R)

================================================================================
ðŸ§ª PHASE 3: Tests Backend (direct curl, optionnel)
================================================================================

Si tu veux vÃ©rifier que le backend fonctionne avant de tester le cockpit:

[ ] ExÃ©cuter depuis un terminal:
    curl -sS -H "X-API-Key: kTxWKxMrrrEXtM132Vd1Qqc4Zf6QsmQKLOo_W1PuDWE" \
      "https://mcp-memory-proxy-522732657254.us-central1.run.app/infra/whoami"

    RÃ©sultat attendu: JSON avec "config": {"read_only_mode": "true", ...}

[ ] Tester pagination:
    curl -sS -H "X-API-Key: kTxWKxMrrrEXtM132Vd1Qqc4Zf6QsmQKLOo_W1PuDWE" \
      "https://mcp-memory-proxy-522732657254.us-central1.run.app/sheets/SETTINGS?limit=1"

    RÃ©sultat attendu: JSON avec "row_count": 1

================================================================================
âœ… PHASE 4: Validation Cockpit (P0 + P1)
================================================================================

Test 1: ðŸ”Œ Test Connection
---------------------------
Menu: IAPF Memory > MCP Cockpit > ðŸ”Œ Test Connection

[ ] Clic sur "Test Connection"
[ ] RÃ©sultat attendu:
    âœ… Popup "MCP Proxy â€” Connection OK"
    âœ… Version: v3.1.5-infra-config-fix
    âœ… Status: 200

âŒ Si Ã©chec, vÃ©rifier:
   â€¢ SETTINGS: mcp_proxy_url correct
   â€¢ SETTINGS: mcp_api_key prÃ©sent

Test 2: ðŸ” GET /infra/whoami
-----------------------------
Menu: IAPF Memory > MCP Cockpit > ðŸ” GET /infra/whoami

[ ] Clic sur "GET /infra/whoami"
[ ] RÃ©sultat attendu:
    âœ… Popup "MCP Proxy â€” Infrastructure Info"
    âœ… Project: box-magique-gp-prod
    âœ… Region: us-central1
    âœ… Service: mcp-memory-proxy
    âœ… Revision: mcp-memory-proxy-00025-zmb
    âœ… Version: v3.1.5-infra-config-fix
    âœ… Config:
       read_only_mode: true
       enable_actions: false
       dry_run_mode: true
       log_level: INFO

âŒ Si Ã©chec:
   â€¢ Backend probablement OK (testÃ© en Phase 3)
   â€¢ VÃ©rifier SETTINGS (API key correcte)

Test 3: ðŸ“Š Test Pagination (P0 validation)
-------------------------------------------
Menu: IAPF Memory > MCP Cockpit > ðŸ“Š Test Pagination

[ ] Clic sur "Test Pagination"
[ ] Confirmer "YES" dans le popup de confirmation
[ ] RÃ©sultat attendu:
    âœ… Popup "MCP Proxy â€” Pagination Tests"
    âœ… SETTINGS?limit=1 â†’ 1 rows
    âœ… MEMORY_LOG?limit=5 â†’ 5 rows
    âœ… DRIVE_INVENTORY?limit=10 â†’ 10 rows

âŒ Si un test Ã©choue (e.g., HTTP 404):
   â€¢ Onglet manquant dans la Google Sheet
   â€¢ VÃ©rifier que MEMORY_LOG, SETTINGS, DRIVE_INVENTORY existent

Test 4: ðŸ› ï¸ HTTP GET Tool (P1 validation)
-----------------------------------------
Menu: IAPF Memory > MCP Cockpit > ðŸ› ï¸ HTTP GET Tool

[ ] Clic sur "HTTP GET Tool"
[ ] Entrer path: /health
[ ] Clic OK
[ ] Entrer query params: (laisser vide)
[ ] Clic OK
[ ] RÃ©sultat attendu:
    âœ… Popup "MCP Proxy â€” HTTP GET Result"
    âœ… Status: 200
    âœ… Response: {"status":"healthy","version":"v3.1.5-infra-config-fix"}

[ ] Tester avec query params:
    Path: /sheets/SETTINGS
    Query params: limit=1
[ ] RÃ©sultat attendu:
    âœ… Status: 200
    âœ… Response contient: "row_count": 1

âŒ Si erreur "Exception":
   â€¢ VÃ©rifier syntaxe query params (format: key=value&key2=value2)
   â€¢ Pas d'espaces, pas de "?" au dÃ©but

================================================================================
ðŸ” Test 5: Validation READ-ONLY MODE (P0)
================================================================================

Test tentative POST (devrait Ãªtre bloquÃ©):

[ ] Menu: IAPF Memory > MCP Cockpit > ðŸ› ï¸ HTTP GET Tool
[ ] Entrer path: /propose
[ ] Note: L'outil est GET only, donc le POST est impossible Ã  envoyer
    depuis le cockpit (âœ… comportement attendu)

Test depuis terminal (optionnel):
[ ] ExÃ©cuter:
    curl -X POST -H "X-API-Key: kTxWKxMrrrEXtM132Vd1Qqc4Zf6QsmQKLOo_W1PuDWE" \
      "https://mcp-memory-proxy-522732657254.us-central1.run.app/propose" \
      -H "Content-Type: application/json" \
      -d '{"type":"test"}'

[ ] RÃ©sultat attendu:
    âœ… HTTP 403
    âœ… Response: {"detail":"Write operations are disabled (READ_ONLY_MODE=true)","audit_safe":true}

================================================================================
ðŸ“Š RÃ‰CAPITULATIF VALIDATION
================================================================================

P0 â€” Backend (audit-safe):
[ ] âœ… /infra/whoami retourne config.read_only_mode=true
[ ] âœ… Query params ?limit= fonctionnent (1, 5, 10 testÃ©s)
[ ] âœ… POST bloquÃ©s (READ_ONLY_MODE=true)
[ ] âœ… Erreurs surfacent status_code + body + correlation_id

P1 â€” Cockpit HTTP Client:
[ ] âœ… Menu items prÃ©sents (4 nouvelles actions)
[ ] âœ… Test Connection fonctionne
[ ] âœ… GET /infra/whoami affiche config complet
[ ] âœ… Test Pagination passe (3 sheets testÃ©es)
[ ] âœ… HTTP GET Tool utilisable (prompt path + query params)

================================================================================
ðŸš¨ TROUBLESHOOTING
================================================================================

ProblÃ¨me 1: "SETTINGS sheet not found"
---------------------------------------
Solution:
  â€¢ VÃ©rifier que l'onglet SETTINGS existe dans la Google Sheet
  â€¢ Recharger la page (F5 / Ctrl+R)

ProblÃ¨me 2: "mcp_proxy_url not found"
--------------------------------------
Solution:
  â€¢ VÃ©rifier que la clÃ© "mcp_proxy_url" est bien Ã©crite (pas de typo)
  â€¢ VÃ©rifier colonne A (key) et colonne B (value) dans SETTINGS

ProblÃ¨me 3: "HTTP 403" dans Test Connection
--------------------------------------------
Solution:
  â€¢ VÃ©rifier que mcp_api_key est correcte dans SETTINGS
  â€¢ Tester depuis curl (Phase 3) pour confirmer que le backend fonctionne

ProblÃ¨me 4: "HTTP 404" dans Test Pagination
--------------------------------------------
Solution:
  â€¢ VÃ©rifier que l'onglet testÃ© existe (MEMORY_LOG, SETTINGS, DRIVE_INVENTORY)
  â€¢ Si onglet manquant, crÃ©er via: IAPF Memory > Initialiser / Valider HUB

ProblÃ¨me 5: Menus MCP Cockpit absents
--------------------------------------
Solution:
  â€¢ VÃ©rifier que G01_UI_MENU.gs contient les 4 nouvelles actions
  â€¢ Fermer et rouvrir la Google Sheet (force refresh)
  â€¢ VÃ©rifier que G09_MCP_HTTP_CLIENT.gs est bien prÃ©sent dans le projet

================================================================================
âœ… VALIDATION FINALE
================================================================================

[ ] Tous les tests de Phase 4 passent (Tests 1-4) âœ…
[ ] READ-ONLY MODE validÃ© (Test 5) âœ…
[ ] Aucune erreur dans logs Apps Script (View > Logs) âœ…

[ ] Si tout est âœ…:
    â†’ Marquer comme "PRODUCTION READY" âœ…
    â†’ Informer GenSpark que P0 + P1 sont validÃ©s âœ…

[ ] Si des tests Ã©chouent:
    â†’ Noter les erreurs exactes (status_code, message)
    â†’ VÃ©rifier Troubleshooting ci-dessus
    â†’ Contacter GenSpark avec les dÃ©tails d'erreur

================================================================================
ðŸ“§ CONTACT SUPPORT
================================================================================

En cas de problÃ¨me non rÃ©solu:
  â€¢ Rapport complet: RAPPORT_COCKPIT_P0_P1_FINAL.md
  â€¢ Architecture: ARCHITECTURE_COCKPIT_P0_P1.txt
  â€¢ Quick start: README_COCKPIT_QUICK_START.txt
  â€¢ Tests backend: ./test_cockpit_p0_p1.sh

Logs backend Cloud Run:
  https://console.cloud.google.com/run?project=box-magique-gp-prod

GitHub commits:
  https://github.com/romacmehdi971-lgtm/box-magic-ocr-intelligent
  Commits: 09a3988 â†’ 60d53b8 â†’ 9e1401f â†’ 4aeb137 â†’ ac90651 â†’ 33c2cf4

================================================================================
ðŸŽ‰ FIN DE LA CHECKLIST â€” Bonne validation ! ðŸš€
================================================================================
